## TCP协议
TCP，全称Transmission Control Protocol，传输控制协议。**双工**协议。是主机对主机层的传输控制协议，提供可靠的连接服务。

对于前端而言，最常用的就是需要理解“三次握手”和“四次挥手”这两个重要的解决方案。

这两个方案是为了解决连接建立和连接关闭的问题的。

## 建立连接
> 例子：打电话/视频时，双方如何确定自己能够听到对方的声音，对方能够听到自己的声音呢？
> 具体场景：
> A->B：你可以听到吗？（A发起询问，以确定B能否听到自己的声音？）
> B->A：可以。你呢？（B听到A的询问，B能确定能够听到A的声音**B←A**！B发起询问，确定A能否听到自己的声音？当A听到B的回复时，A能确定能听到B的声音**A←B**，且B能听到自己的声音**A→B**）
> A->B：可以，我们开始说话吧。（当B收到A的回复时，B能确定A能听到自己的声音**B→A**）

图示如下：
![](https://mmbiz.qpic.cn/mmbiz_png/meG6Vo0Mevh5GSvJvRLPkCybNicq27Q8WkpUWQiate0JIUXYJ6iaSeyfxhfAia4Z464UyRibmZhrymRicicuFRS2ZSBiaQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1)

同理，“三次握手”也是如此：
![](https://mmbiz.qpic.cn/mmbiz_png/meG6Vo0Mevh5GSvJvRLPkCybNicq27Q8WRxZz6JzsB1uHsKJ1MFUWrLIFZUeJJZNbTXbxPYmNVdBRib8Q6krQ2OQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1)

**原则上任何数据传输都无法确保绝对可靠，三次握手只是确保可靠的基本需要。**

## 关闭连接
因为TCP是双工协议，所以其实无论是建立连接还是关闭连接，双方的地位是相同的。

当主动方请求关闭连接，到最终关闭连接，需要经历4个阶段，即“**四次挥手**”（**确保数据能够完整传输**）：

- 主动方向被动方发送一个请求，内容为关闭连接（此时说明了主动方已经没有数据要发送给被动方了）
- 被动方收到后这个请求后，并不会马上关闭连接，因为有可能还需要发送数据给主动方，这是会告知主动方已经知道了
- 被动方也没有数据发送给主动方后，会给主动方发送“好了，可以关闭了”
- 主动方收到后，会给被动方发送“好的”，随即主动方关闭、被动方关闭

图示如下：
![](https://mmbiz.qpic.cn/mmbiz_png/meG6Vo0Mevh5GSvJvRLPkCybNicq27Q8WhVX4cp51KdTzCfOM2zP0URoYbIAHJfeBveziaUWd1aILSRm56uJBxwA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1)

## SYN攻击
这个出现在三次握手过程中，如果建立连接方（Client）同时向（Server）发起建立大量请求（伪造大量不存在的IP发送SYN包），Server会一直向Client发送确认包直至超时。而这长期占用的未连接队列会导致正常的请求因为队列满而被丢弃，从而引起网络堵塞甚至系统瘫痪。这是一种典型的DDOS攻击。

监测SYN攻击的方式即当Server上有大量半连接状态且源IP地址是随即的，则可以断定遭到SYN攻击了，执行如下命令：

```
netstat -nap | grep SYN_RECV
```
## 附注
前端面试中经常会遇到的问题有：

- “三次握手”和“四次挥手”是什么？流程？
- 为什么建立连接是三次，而关闭连接却是四次？
原作者解答是：

> 这是因为服务端在LISTEN状态下，收到建立连接请求的SYN报文后，把ACK和SYN放在一个报文里发送给客户端。而关闭连接时，当收到对方的FIN报文时，仅仅表示对方不再发送数据了但是还能接收数据，己方也未必全部数据都发送给对方了，所以己方可以立即close，也可以发送一些数据给对方后，再发送FIN报文给对方来表示同意现在关闭连接，因此，己方ACK和FIN一般都会分开发送。

即接收请求方，在建立连接时给主动方发了一个报文，而关闭时会发送两个报文，多出来的一个是传输数据，以确保数据的完整传输。

## 其他
目前对建立连接和关闭连接的流程做了了解，但其中协议的内容、原理和报文的一些关键字段还需要进一步学习。

（本篇完）